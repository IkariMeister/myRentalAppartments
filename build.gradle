// Top-level build file where you can add configuration options common to all sub-projects/modules.

buildscript {
    ext.kotlin_version = '1.3.71'
    ext.detekt_version = '1.7.0'
    ext.ktlint_version = '0.34.2'
    repositories {
        google()
        jcenter()
        maven { url "https://plugins.gradle.org/m2/" }
        
    }
    dependencies {
        classpath "com.android.tools.build:gradle:3.5.3"
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
        classpath "io.gitlab.arturbosch.detekt:detekt-gradle-plugin:$detekt_version"
        // NOTE: Do not place your application dependencies here; they belong
        // in the individual module build.gradle files
    }
}

allprojects {
    repositories {
        google()
        jcenter()
        
    }

}
subprojects {

    apply plugin: 'io.gitlab.arturbosch.detekt'
    apply from: "../ktlint.gradle"

    detekt {
        toolVersion = "$detekt_version"
        parallel = false
        config = files("$projectDir/config/detekt/config.yml")
        buildUponDefaultConfig = false                        // Interpret config files as updates to the default config. `false` by default.
        baseline = file("$projectDir/config/detekt/baseline.xml")               // Specifying a baseline file. All findings stored in this file in subsequent runs of detekt.
        disableDefaultRuleSets = false                        // Disables all default detekt rulesets and will only run detekt with custom rules defined in plugins passed in with `detektPlugins` configuration. `false` by default.
        debug = false                                         // Adds debug output during task execution. `false` by default.
        ignoreFailures = false                                // If set to `true` the build does not fail when the maxIssues count was reached. Defaults to `false`.
        reports {
            xml {
                enabled = true                                // Enable/Disable XML report (default: true)
                destination = file("build/reports/detekt.xml") // Path where XML report will be stored (default: `build/reports/detekt/detekt.xml`)
            }
            html {
                enabled = true                                // Enable/Disable HTML report (default: true)
                destination = file("build/reports/detekt.html") // Path where HTML report will be stored (default: `build/reports/detekt/detekt.html`)
            }
            txt {
                enabled = true                                // Enable/Disable TXT report (default: true)
                destination = file("build/reports/detekt.txt") // Path where TXT report will be stored (default: `build/reports/detekt/detekt.txt`)
            }
            custom {
                reportId = "CustomJsonReport"                   // The simple class name of your custom report.
                destination = file("build/reports/detekt.json") // Path where report will be stored
            }
        }
    }

    tasks.register("prec") {
        group = "git"
        description = "Things that should be done before commit"
        doFirst {
            println "Executing pre commit tasks"
        }
    }
    prec.dependsOn detekt
    prec.dependsOn ktlintFormat

    tasks.register("prep") {
        group = "git"
        description = "Things that should be done before push"
    }
    //TODO add depending tasks for testing
}

task clean(type: Delete) {
    delete rootProject.buildDir
}
